<!-- BEGIN #header -->
<div id="header" class="app-header" [attr.data-bs-theme]="this.appSettings.appHeaderInverse ? 'dark' : ''">
  <!-- BEGIN navbar-header -->
  <div class="navbar-header">
    @if (this.appSidebarTwo) {
      <button type="button" class="navbar-mobile-toggler" (click)="toggleAppSidebarEndMobile()">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    }
    <a href="/" class="navbar-brand">
      <img src="HomeSynchronicityLogo_SlimDark.png" alt="HomeSynchronicity" class="navbar-logo">
    </a>
    @if (this.appSettings.appTopMenu && !this.appSettings.appSidebarNone) {
      <button type="button" class="navbar-mobile-toggler" (click)="toggleAppTopMenuMobile()">
        <span class="fa-stack fa-lg text-inverse">
          <i class="far fa-square fa-stack-2x"></i>
          <i class="fa fa-cog fa-stack-1x"></i>
        </span>
      </button>
    }
    @if (this.appSettings.appHeaderMegaMenu) {
      <button type="button" class="navbar-mobile-toggler" (click)="toggleAppHeaderMegaMenuMobile()">
        <span class="fa-stack fa-lg text-inverse">
          <i class="far fa-square fa-stack-2x"></i>
          <i class="fa fa-cog fa-stack-1x"></i>
        </span>
      </button>
    }
    @if (!this.appSettings.appSidebarNone) {
      <button type="button" class="navbar-mobile-toggler" (click)="toggleAppSidebarMobile()">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    }
    @if (this.appSettings.appTopMenu && this.appSettings.appSidebarNone) {
      <button type="button" class="navbar-mobile-toggler" (click)="toggleAppTopMenuMobile()">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    }
  </div>
  <!-- END navbar-header -->

  <!-- BEGIN nav -->
  <div class="navbar-nav">
    <div class="navbar-item navbar-form">
      <form action="" method="POST" name="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Enter keyword" />
          <button type="submit" class="btn btn-search">Search</button>
        </div>
      </form>
    </div>

    <!-- Quick Actions Button -->
    <div class="navbar-item">
      <a href="javascript:;" (click)="toggleQuickActions()" class="navbar-link icon" title="Quick Actions">
        <i class="fa fa-bolt"></i>
      </a>
    </div>

    <!-- Alerts Bell -->
    <div class="navbar-item">
      <a routerLink="/alerts" class="navbar-link icon alert-bell-link">
        <i class="fa fa-bell alert-bell-icon"></i>
        @if (notificationCount() > 0) {
          <span class="badge">{{ notificationCount() }}</span>
        }
      </a>
    </div>

    <!-- Alerts Dropdown -->
    <div class="navbar-item dropdown">
      <a href="javascript:;" data-bs-toggle="dropdown" class="navbar-link dropdown-toggle icon">
        <i class="fa fa-clipboard alert-preview-icon"></i>
      </a>
      <div class="dropdown-menu media-list dropdown-menu-end">
        <div class="dropdown-header">ALERTS ({{ notificationCount() }})</div>
        @if (recentAlerts().length > 0) {
          @for (alert of recentAlerts(); track alert.id) {
            <a [routerLink]="alert.actionUrl || '/alerts'" class="dropdown-item media" [class.unread-alert]="!alert.isRead">
              <div class="media-left">
                <div class="alert-icon alert-icon--{{ alert.severity.toLowerCase() }}">
                  {{ getSeverityIcon(alert.severity) }}
                </div>
              </div>
              <div class="media-body">
                <h6 class="media-heading">
                  {{ alert.title }}
                  @if (!alert.isRead) {
                    <span class="badge bg-primary ms-1">New</span>
                  }
                </h6>
                <p class="mb-0">{{ alert.message }}</p>
                <div class="text-muted fs-10px">{{ getRelativeTime(alert.createdAt) }}</div>
              </div>
              @if (!alert.isRead) {
                <div class="media-right">
                  <button class="btn btn-sm btn-link text-muted" (click)="markAlertAsRead(alert.id, $event)" title="Mark as read">
                    Check
                  </button>
                </div>
              }
            </a>
          }
        } @else {
          <div class="text-center w-300px py-3">No alerts at this time</div>
        }
        <div class="dropdown-footer text-center">
          <a routerLink="/alerts" class="text-decoration-none">View all alerts</a>
        </div>
      </div>
    </div>

    <!-- USER DROPDOWN ‚Äî FULLY SIGNALS + ZONLESS -->
    <div class="navbar-item navbar-user dropdown">
      @if (isAuthenticated()) {
        <a href="javascript:;" class="navbar-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown">
          <div class="image image-icon bg-primary text-white fw-bold">
            {{ userInitials() }}
          </div>
          <span>
            <span class="d-none d-md-inline">{{ userDisplayName() }}</span>
            <b class="caret"></b>
          </span>
        </a>
        <div class="dropdown-menu dropdown-menu-end me-1">
          <div class="dropdown-header">
            <span class="d-block fw-bold">{{ userDisplayName() }}</span>
            <small class="text-muted">{{ user()?.email }}</small>
          </div>
          <div class="dropdown-divider"></div>
          <a routerLink="/profile" class="dropdown-item">
            <i class="fa fa-user-circle fa-fw me-2"></i>Edit Profile
          </a>
          <a routerLink="/settings" class="dropdown-item">
            <i class="fa fa-cog fa-fw me-2"></i>Settings
          </a>
          <div class="dropdown-divider"></div>
          <a href="javascript:;" class="dropdown-item text-danger" (click)="logout()">
            <i class="fa fa-sign-out-alt fa-fw me-2"></i>Log Out
          </a>
        </div>
      } @else {
        <a routerLink="/login" class="navbar-link">
          <i class="fa fa-sign-in-alt fa-fw me-2"></i>
          <span class="d-none d-md-inline">Login</span>
        </a>
      }
    </div>

    <!-- Right Sidebar Toggle -->
    @if (this.appSidebarTwo) {
      <div class="navbar-divider d-none d-md-block"></div>
      <div class="navbar-item d-none d-md-block">
        <a href="javascript:;" (click)="toggleAppSidebarEnd()" class="navbar-link icon">
          <i class="fa fa-th"></i>
        </a>
      </div>
    }
  </div>
  <!-- END nav -->
</div>
<!-- END #header -->

<!-- Quick Actions Drawer (Bootstrap Offcanvas) -->
<div class="offcanvas offcanvas-top" [class.show]="isQuickActionsOpen()" tabindex="-1" id="quickActionsDrawer" 
     [attr.aria-hidden]="!isQuickActionsOpen()" [attr.aria-labelledby]="'quickActionsDrawerLabel'">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="quickActionsDrawerLabel">
      <i class="fa fa-bolt me-2"></i>Quick Actions
    </h5>
    <button type="button" class="btn-close btn-close-white" (click)="closeQuickActions()" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="quick-actions-grid">
      <a [routerLink]="['/bills']" class="quick-action-card" (click)="closeQuickActions()">
        <div class="quick-action-icon">üí≥</div>
        <div class="quick-action-label">Pay Bill</div>
      </a>
      <a [routerLink]="['/financial']" class="quick-action-card" (click)="closeQuickActions()">
        <div class="quick-action-icon">üí∞</div>
        <div class="quick-action-label">Add Transaction</div>
      </a>
      <a [routerLink]="['/maintenance']" class="quick-action-card" (click)="closeQuickActions()">
        <div class="quick-action-icon">üî®</div>
        <div class="quick-action-label">Schedule Task</div>
      </a>
      <a [routerLink]="['/documents']" class="quick-action-card" (click)="closeQuickActions()">
        <div class="quick-action-icon">üìÑ</div>
        <div class="quick-action-label">Upload Document</div>
      </a>
      <a [routerLink]="['/healthcare']" class="quick-action-card" (click)="closeQuickActions()">
        <div class="quick-action-icon">üè•</div>
        <div class="quick-action-label">Healthcare</div>
      </a>
    </div>
  </div>
</div>

<!-- Backdrop for drawer -->
@if (isQuickActionsOpen()) {
  <div class="offcanvas-backdrop fade show" (click)="closeQuickActions()"></div>
}