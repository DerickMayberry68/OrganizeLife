<header class="topbar" (click)="closeDropdowns()">
  <div class="topbar__brand">
    <span class="topbar__logo">üé©</span>
    <span class="topbar__name"><b>The</b>Butler</span>
  </div>

  <div class="topbar__nav">
    <!-- Search Form -->
    <div class="topbar__search">
      <form class="search-form">
        <input type="text" class="search-input" placeholder="Enter keyword..." />
        <button type="submit" class="search-btn">
          <i class="search-icon">üîç</i>
        </button>
      </form>
    </div>

    <!-- Right Side -->
    <div class="topbar__actions">
      <!-- Notifications -->
      <div class="topbar__item" (click)="toggleNotifications($event)">
        <a href="javascript:;" class="topbar__link">
          <span class="topbar__icon">üîî</span>
          @if (notificationCount() > 0) {
            <span class="topbar__badge">{{ notificationCount() }}</span>
          }
        </a>

        @if (isNotificationsOpen()) {
          <div class="dropdown notifications-dropdown" (click)="$event.stopPropagation()">
            <div class="dropdown__header">
              <strong>ALERTS ({{ notificationCount() }})</strong>
            </div>
            <div class="dropdown__body">
              @if (recentAlerts().length > 0) {
                @for (alert of recentAlerts(); track alert.id) {
                  <a href="javascript:;" 
                     class="notification-item" 
                     [class.notification-item--unread]="!alert.isRead"
                     (click)="navigateToAlert(alert)">
                    <div class="notification-item__icon" 
                         [class]="'notification-item__icon--' + alert.severity.toLowerCase()">
                      {{ getSeverityIcon(alert.severity) }}
                    </div>
                    <div class="notification-item__content">
                      <h6 class="notification-item__title">{{ alert.title }}</h6>
                      <p class="notification-item__message">{{ alert.message }}</p>
                      <div class="notification-item__time">{{ getRelativeTime(alert.createdAt) }}</div>
                    </div>
                    @if (!alert.isRead) {
                      <button 
                        class="notification-item__mark-read"
                        (click)="markAlertAsRead(alert.id, $event)"
                        title="Mark as read">
                        ‚úì
                      </button>
                    }
                  </a>
                }
              } @else {
                <div class="notification-item notification-item--empty">
                  <div class="notification-item__content">
                    <p class="notification-item__message">No alerts at this time</p>
                  </div>
                </div>
              }
            </div>
            <div class="dropdown__footer">
              <a href="javascript:;" class="dropdown__link" (click)="viewAllAlerts()">View all alerts</a>
            </div>
          </div>
        }
      </div>

      <!-- User Profile -->
      <div class="topbar__item topbar__user-dropdown" (click)="toggleProfile($event)">
        <a href="javascript:;" class="topbar__link topbar__user-link">
          <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40'%3E%3Crect fill='%23d4af37' width='40' height='40'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='20' fill='%231a1a2e'%3Eüé©%3C/text%3E%3C/svg%3E" 
               alt="User" 
               class="topbar__avatar" />
          <span class="topbar__user-text">
            <span class="topbar__user-name">{{ user.name }}</span>
            <b class="topbar__caret">‚ñº</b>
          </span>
        </a>

        @if (isProfileOpen()) {
          <div class="dropdown profile-dropdown" (click)="$event.stopPropagation()">
            <a [routerLink]="['/profile']" class="dropdown__item">
              <span class="dropdown__icon">üë§</span>
              <span>Edit Profile</span>
            </a>
            <a href="javascript:;" class="dropdown__item">
              <span class="dropdown__icon">üìß</span>
              <span>Inbox</span>
              <span class="dropdown__badge badge badge--error">2</span>
            </a>
            <a href="javascript:;" class="dropdown__item">
              <span class="dropdown__icon">üìÖ</span>
              <span>Calendar</span>
            </a>
            <a [routerLink]="['/settings']" class="dropdown__item">
              <span class="dropdown__icon">‚öôÔ∏è</span>
              <span>Settings</span>
            </a>
            <div class="dropdown__divider"></div>
            <a href="javascript:;" class="dropdown__item" (click)="logout()">
              <span class="dropdown__icon">üö™</span>
              <span>Log Out</span>
            </a>
          </div>
        }
      </div>
    </div>
  </div>
</header>
