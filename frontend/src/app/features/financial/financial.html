<div class="financial">
  <h1 class="page-header">
    ðŸ’° Financial Management
    <div class="page-header__actions">
      <button class="btn btn--accent" (click)="openTransactionDialog()">
        + Add Transaction
      </button>
      <button class="btn btn--outline" (click)="openBudgetDialog()">
        + Add Budget
      </button>
    </div>
  </h1>

  <!-- Financial Overview -->
    <section class="financial__overview">
      <app-stat-card
        title="Total Budget"
        [value]="formatCurrency(totalBudget())"
        icon="ðŸ’µ"
        variant="accent"
      />
      
      <app-stat-card
        title="Total Spent"
        [value]="formatCurrency(totalSpent())"
        icon="ðŸ’³"
        variant="warning"
      />
      
      <app-stat-card
        title="Remaining"
        [value]="formatCurrency(budgetRemaining())"
        icon="ðŸ’°"
        [variant]="budgetRemaining() < 0 ? 'error' : 'success'"
      />
    </section>

    <!-- Budget Chart -->
    @if (budgetChartData().length > 0) {
      <section class="financial__section">
        <div class="card">
          <div class="card-header">
            <h3>Budget Analysis</h3>
          </div>
          <div class="card-content">
            <ejs-chart
              style="display:block"
              [primaryXAxis]="primaryXAxis"
              [primaryYAxis]="primaryYAxis"
              [title]="chartTitle"
              [tooltip]="tooltip"
              [height]="'350'">
              <e-series-collection>
                <e-series 
                  [dataSource]="budgetChartData()" 
                  type='Column' 
                  xName='x' 
                  yName='y' 
                  name='Spent'
                  [marker]="marker"
                  fill='#d4af37'>
                </e-series>
                <e-series 
                  [dataSource]="budgetChartData()" 
                  type='Column' 
                  xName='x' 
                  yName='limit' 
                  name='Budget Limit'
                  [marker]="marker"
                  fill='#1a1a2e'>
                </e-series>
              </e-series-collection>
            </ejs-chart>
          </div>
        </div>
      </section>
    }

    <!-- Budget Categories -->
    <section class="financial__section">
      <h2>Budget by Category</h2>
      <div class="budget-grid">
        @for (budget of budgets(); track budget.id) {
          <div class="card budget-card">
            <div class="budget-card__header">
              <h3>{{ budget.category }}</h3>
              <span class="budget-card__period">{{ budget.period }}</span>
            </div>
            <div class="budget-card__content">
              <div class="budget-card__progress">
                <div class="progress-bar">
                  <div 
                    class="progress-bar__fill" 
                    [class]="'progress-bar__fill--' + getBudgetStatus(getBudgetPercentage(budget.spent, budget.limit))"
                    [style.width.%]="getBudgetPercentage(budget.spent, budget.limit)">
                  </div>
                </div>
                <div class="progress-bar__labels">
                  <span>{{ formatCurrency(budget.spent) }}</span>
                  <span>{{ formatCurrency(budget.limit) }}</span>
                </div>
              </div>
              
              <div class="budget-card__footer">
                <span class="budget-card__percentage">
                  {{ getBudgetPercentage(budget.spent, budget.limit).toFixed(0) }}% used
                </span>
                <span 
                  class="badge" 
                  [class]="'badge--' + getBudgetStatus(getBudgetPercentage(budget.spent, budget.limit))">
                  {{ getBudgetStatus(getBudgetPercentage(budget.spent, budget.limit)) }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>
    </section>

    <!-- Recent Transactions -->
    <section class="financial__section">
      <div class="card">
        <div class="card-header">
          <h3>Recent Transactions</h3>
        </div>
        <div class="card-content">
          @if (transactions().length > 0) {
            <ejs-grid 
              [dataSource]="transactions()" 
              [allowPaging]="true"
              [allowSorting]="true"
              [allowFiltering]="true"
              [pageSettings]="pageSettings"
              [filterSettings]="filterSettings">
              <e-columns>
                <e-column field="date" headerText="Date" width="120" [format]="formatDate"></e-column>
                <e-column field="description" headerText="Description" width="200"></e-column>
                <e-column field="category" headerText="Category" width="120"></e-column>
                <e-column field="type" headerText="Type" width="100"></e-column>
                <e-column field="amount" headerText="Amount" width="120" textAlign="Right" [format]="formatAmount"></e-column>
              </e-columns>
            </ejs-grid>
          } @else {
            <div class="empty-state">
              <p>No transactions recorded yet</p>
            </div>
          }
        </div>
      </div>
    </section>

    <!-- Add Transaction Dialog -->
    <ejs-dialog
      #transactionDialog
      header="Add Transaction"
      [width]="dialogWidth"
      [isModal]="true"
      [visible]="false"
      [animationSettings]="animationSettings"
      [buttons]="transactionDialogButtons">
      <ng-template #content>
        <form [formGroup]="transactionForm" class="form">
          <div class="form-group">
            <label>Description *</label>
            <ejs-textbox formControlName="description" placeholder="Enter description"></ejs-textbox>
          </div>

          <div class="form-group">
            <label>Amount *</label>
            <ejs-numerictextbox
              formControlName="amount"
              [min]="0"
              [step]="0.01"
              format="c2"
              placeholder="0.00">
            </ejs-numerictextbox>
          </div>

          <div class="form-group">
            <label>Category *</label>
            <ejs-dropdownlist
              formControlName="category"
              [dataSource]="categories"
              placeholder="Select category">
            </ejs-dropdownlist>
          </div>

          <div class="form-group">
            <label>Type *</label>
            <ejs-dropdownlist
              formControlName="type"
              [dataSource]="transactionTypes"
              placeholder="Select type">
            </ejs-dropdownlist>
          </div>

          <div class="form-group">
            <label>Date *</label>
            <ejs-datepicker formControlName="date"></ejs-datepicker>
          </div>
        </form>
      </ng-template>
    </ejs-dialog>

    <!-- Add Budget Dialog -->
    <ejs-dialog
      #budgetDialog
      header="Add Budget Category"
      [width]="dialogWidth"
      [isModal]="true"
      [visible]="false"
      [animationSettings]="animationSettings"
      [buttons]="budgetDialogButtons">
      <ng-template #content>
        <form [formGroup]="budgetForm" class="form">
          <div class="form-group">
            <label>Category *</label>
            <ejs-textbox formControlName="category" placeholder="Enter category name"></ejs-textbox>
          </div>

          <div class="form-group">
            <label>Budget Limit *</label>
            <ejs-numerictextbox
              formControlName="limit"
              [min]="0"
              [step]="10"
              format="c2"
              placeholder="0.00">
            </ejs-numerictextbox>
          </div>

          <div class="form-group">
            <label>Period *</label>
            <ejs-dropdownlist
              formControlName="period"
              [dataSource]="budgetPeriods"
              placeholder="Select period">
            </ejs-dropdownlist>
          </div>
        </form>
      </ng-template>
    </ejs-dialog>
</div>
